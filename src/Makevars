PKG_CPPFLAGS = -I../inst/include -I./llama -I./ggml -I./ggml/ggml-cpu -D_GNU_SOURCE -D_POSIX_C_SOURCE=200809L
PKG_CXXFLAGS = -std=gnu++17 -O2 -fPIC -DNDEBUG -DGGML_USE_CPU
PKG_CFLAGS = -std=gnu11 -O2 -fPIC -DNDEBUG -DGGML_USE_CPU -D_GNU_SOURCE -D_POSIX_C_SOURCE=200809L
PKG_LIBS = -lpthread

# Main package objects - START MINIMAL
OBJECTS = bindings.o RcppExports.o

# Core GGML (minimal essential)  
OBJECTS += ggml/ggml.o ggml/ggml-alloc.o ggml/gguf.o

# Essential backend files (add incrementally)
OBJECTS += ggml/ggml-backend.o ggml/ggml-backend-reg.o

# Add quantization support (contains dequantize_row_q4_0 and similar functions)
OBJECTS += ggml/ggml-quants.o

# Add threading support (may be needed for some operations)
OBJECTS += ggml/ggml-threading.o

# Build rules
all: $(SHLIB)

clean:
	rm -f $(OBJECTS) $(SHLIB)